<!DOCTYPE html>
<html>

<head>
    <title>Home</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- CSS only -->
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/header.css">
   <link rel="stylesheet" href="../css/footer.css">
   <link rel="stylesheet" href="../css/listapresenze.css">
   <link rel="stylesheet" href="../css/calendario.css">
   <link rel="stylesheet" href="../css/post.css">
   <link rel="stylesheet" href="../css/resoconti.css">
   <link rel="stylesheet" href="../css/listaLavorDaAgg.css">
   <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    
    <script src="../js/calendario.js"></script>
    <script src="../js/listaLavorDaAgg.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    
    
    <script src="../js/checklogin.js"></script>

    <script src="../../models/Post.js"></script>
    <script src="../../models/Personale.js"></script>

</head>
<body>
    <!-- importo header -->
    <div id="header" style="position: fixed; width: 100%; top:0;"></div>
    <a name="inizio">inizio</a>
   <!-- Inizio suddivisione pagina -->
        <div style="position: fixed; top: 10%;">
            
            <!-- Sezione di sinistra -->
            <div class="" >
                <!-- Sezione di sinistra  alto-->
                <!-- calendario -->                    
                <div id="calendario"></div>
                <div> <input type="date" style="margin-left: 30px; margin-bottom: 30px;"></div>
                <div>
                    <!-- Sezione di sinistra  basso-->
                    <!-- lista presenze -->
                    <div id="listapresenze"></div>
                    <div id="listaLavorDaAgg"></div>
            </div>
            </div>
            

        </div>
        
        <div style="margin-left: 25%; margin-right: 5%; margin-top: 5%;">
            <div class="" >
                <!-- Sezione di centro alto-->
                <!-- post nuovo -->                                    
                <div id="postNuovo" style="margin-bottom: 5%;padding: 4px 4px 4px 4px;"></div>                
                <div class="" id="resoconti"></div>
                <a href='#inizio'><img src="../img/Freccia.png" style="width: 3%; height: 5%; position: fixed; right: 0; bottom: 0;"></a>                
            </div>
           
                    <!-- Sezione Centrale -->      
        </div> 

</div>


<script>

$( document ).ready(function() {

$("#header").load("header.html");       
$("#listapresenze").load("listapresenze.html");  
$("#postNuovo").load("postNuovo.html");       
$("#resoconti").load("resoconti.html");
$("#listaLavorDaAgg").load("listaLavorDaAgg.html");  


$("#calendario").load("calendario.html",function () {
    setToday();
    defaultSelecter();
});

var url = new URL(window.location);
var id_cantiere = url.searchParams.get("id");        
var datiCantiere = null; // dati cantiere
var datiCommenti = []; // Dati commenti
var datiPresenze = []; // Dati presenze personale

var day = url.searchParams.get("day");        
if(!day) {
    day= (new Date()).toISOString();
}
caricaCantiere(id_cantiere);
caricaCommenti(id_cantiere,day);
//caricaPresenze(idCantiere,day);

}); 



function caricaCantiere(id){
    // Legge il cantiere
    fetch('http://localhost/cantieroni/API/Cantiere/read_by_id.php?id='+id,{credentials: 'include'})
    .then((response) => {
        if(response.ok) {   
            return response.json();
        }
        throw new Error(response.statusText);
    })
    .then((data) => {   
            datiCantiere=data;        
    }).catch((err) => {
        console.log("Cantieri/read_in_corso",err);
    });
}


function caricaCommenti(id_cantiere,day){
    // Legge il cantiere
    fetch('http://localhost/cantieroni/API/Post/read_cantiere.php?id_cantiere='+id_cantiere,{credentials: 'include'})
    .then((response) => {
        if(response.ok) {   
            return response.json();
        }
        throw new Error(response.statusText);
    })
    .then((data) => {   
            datiCommenti=data.data;   
            let str='';     
            for(let i=0;i< datiCommenti.length;i++){
                let comm=datiCommenti[i];
                // console.log(comm);
                str+='<div class="post-resoconto"><div class="resoconto-head"><table><tr><td><img class="fotoprof-resoconto" align="left" src="../img/immagine_profilo_default.png" >&nbsp;'+comm.username; 
                str+='<br>&nbsp;'+comm.ora_post+'</td></tr></table></div><div style="padding: 4px 4px 4px 4px;">'+comm.descrizione+'</div></div>';
            }
            document.getElementById("bodylistaresoconti").innerHTML = str;
    }).catch((err) => {
        console.log("Cantieri/read_in_corso",err);
    });
}

function caricaPresenze(id,day){
    // Legge il cantiere
    //fetch('http://localhost/cantieroni/API/Post/read_cantiere_date.php?id_cantiere='+id+'&ora_post='+day,{credentials: 'include'})
    fetch('http://localhost/cantieroni/API/Post/read_cantiere_date.php?id_cantiere='+id+'&ora_post='+day,{credentials: 'include'})
    .then((response) => {
        if(response.ok) {   
            return response.json();
        }
        throw new Error(response.statusText);
    })
    .then((data) => {   
            datiPresenze=data;        
    }).catch((err) => {
        console.log("Cantieri/read_in_corso",err);
    });
}



</script>

</body>
</html>